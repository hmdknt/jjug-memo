# 秒間200,000 Req/secをさばく広告入札システムを支えるパフォーマンスチューニング術

## メモ

### Logicad


### 広告業界におけるRTD
- RDB(リアルタイムビッディング)
- 広告配信はオークション形式で配信
  - 勝つと売り上げが上がる
  - オークションの開催期間はわずか100ミリ秒

- レイテンシの低減
  - 1回あたりの時間
- スループット向上
  - 1期間における処理量

- ネットワークレイテンシは一定でない
  - 伝送距離の長さによって決まる

- 入札処理が加わるとタイムアウトが増える

- Logicadの入札処理は平均3ミリ秒

### Logicadのアーキテクチャ
- Nginx
- 入札サーバJava(netty)

### Logicadにおけるパフォーマンスチューニング
- 高速化するにはホットスポットを見つけることが必要
- ツールやプロファイラによって計測し目星を付ける

- ツール
  - perf
    - linux向けのCPUプロファイラ
  - perf-map-agent
  - FlameGraph
    
  - JMeter
    - 負荷がけ用

### FlameGraph
- 対象が分かっている場合は、正規表現で簡単に対象を表示することが可能

#### どのような波形を見れば良いか
- 幅を取っている(広い)ところを見れば良い
- 修正前後で比較を行う
  - デグレしていないか確認する

#### チューニング
- チューニングとデグレを計測しながら高速化を進める

### Javaの外側にも目を向ける
- ツール
  - Looking Glass
  - Flame Scope
    - Flame Graphを可視化
- Nginxに問題があることも
- 色々な計測ツールを試すことで新たな発見ができる